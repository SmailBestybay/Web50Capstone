{% extends "auctions/layout.html" %}

{% block body %}
    <h2>Listings</h2>

    {% if message %}
        <div>{{ message }}</div>
    {% endif %}

        For sale: {{ listing.title }}, Description: {{ listing.description }}, Starting Bid: {{ listing.starting_bid }}, Owner: {{ listing.owner }}

        {% if user.is_authenticated %}
        
            <form action="{% url 'listing' listing.id %}" method="post">
                {% csrf_token %}
                {% if watchlisted %}
                    <button class="btn btn-danger" type="submit" name="add_or_remove" value="{{ watchlist_item.id }}">Remove from Watchlist</button>
                {% else %}
                    <button class="btn btn-success" type="submit" name="add_or_remove">Add to Watchlist</button>
                {% endif %}
            </form>

            <div>
                {{ bids }}
                <br>
                Highest bid: {{ highest_bid }}
            </div>
            {% if not listing.closed %}
                <form action="{% url 'listing' listing.id %}" method="post">
                    {% csrf_token %}
                    <div class="form-group">
                        {% if highest_bid == None %}
                            <input autofocus class="form-control" type="number" name="bid" min="{{ listing.starting_bid }}" placeholder="{{ listing.starting_bid }}">
                        {% else %}
                            <input autofocus class="form-control" type="number" name="bid" min="{{ highest_bid.amount }}" placeholder="{{ highest_bid.amount }}">
                        {% endif %}
                    </div>
                    <input class="btn btn-primary" type="submit" value="Place Bid">
                </form>
            {% endif %}
            
            <div>
                {% if user == listing.owner and not listing.closed %}
                    This listing belongs to {{ user.username }}
                    <form action="{% url 'listing' listing.id %}" method="post">
                        {% csrf_token %}
                        <button class="btn btn-primary" type="submit" name="close_listing" value="{{ highest_bid.id }}">Close Listing</button>
                    </form>
                {% endif %}
                
                It belongs to {{ listing.owner }}
                <br>
                Listing winner: {{ listing.winner }}
            </div>

            {% if listing.closed and user == listing.winner %}
                <div>
                    You are the winner!
                </div>
            {% endif %}
        {% endif %}


{% endblock %}